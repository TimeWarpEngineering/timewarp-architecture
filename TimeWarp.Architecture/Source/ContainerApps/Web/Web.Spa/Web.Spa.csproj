<Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">

  <PropertyGroup>
    <Description>TimeWarp Architecture Demo Application</Description>
    <DefineConstants>ReduxDevToolsEnabled;grpc;api;web;counter</DefineConstants>
    <Nullable>enable</Nullable>
    <!--<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>-->
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
    <!-- Uncomment the following line if you want to Mock B2C.
     Note you will need to run all Mock Data if you do
     because the token won't work on the real API -->
<!--    <DefineConstants>$(DefineConstants);MOCK_AUTHENTICATION</DefineConstants>-->
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Ardalis.GuardClauses" />
    <PackageReference Include="Blazor-State" />
    <PackageReference Include="BlazorComponentUtilities"/>
    <PackageReference Include="Grpc.Net.Client"/>
    <PackageReference Include="Grpc.Net.Client.Web"/>
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly"/>
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Authentication"/>
    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.DevServer" PrivateAssets="all"/>
    <PackageReference Include="Microsoft.AspNetCore.SignalR.Client"/>
    <PackageReference Include="Microsoft.Authentication.WebAssembly.Msal" />
    <PackageReference Include="Microsoft.Extensions.Http"/>
    <PackageReference Include="Microsoft.Extensions.Logging.Configuration"/>
    <PackageReference Include="Microsoft.FluentUI.AspNetCore.Components"/>
    <PackageReference Include="Microsoft.FluentUI.AspNetCore.Components.Emoji"/>
    <PackageReference Include="Microsoft.FluentUI.AspNetCore.Components.Icons"/>
    <PackageReference Include="Microsoft.Tye.Extensions.Configuration"/>
    <PackageReference Include="Morris.Blazor.ControlFlow"/>
    <PackageReference Include="Morris.Blazor.FluentValidation"/>
    <PackageReference Include="Morris.Moxy" PrivateAssets="all" GeneratePathProperty="true"/>
    <PackageReference Include="System.Net.Http.Json" PrivateAssets="all"/>
    <PackageReference Include="TimeWarp.State.Plus"/>
    <PackageReference Include="Timewarp.OptionsValidation"/>
    <PackageReference Include="protobuf-net.Grpc"/>
    <PackageReference Include="timewarp-heroicons"/>
    <PackageReference Include="timewarp-simple-icons"/>
  </ItemGroup>

  <ItemGroup>
    <UpToDateCheckBuilt Include="Styles/input.css" Set="Css" />
    <UpToDateCheckBuilt Include="tailwind.config.js" Set="Css" />
  </ItemGroup>

  <ItemGroup>
    <!--#if(api)-->
    <ProjectReference Include="..\..\Api\Api.Contracts\Api.Contracts.csproj"/>
    <!--#endif-->
    <!--#if(grpc)-->
    <ProjectReference Include="..\..\Grpc\Grpc.Contracts\Grpc.Contracts.csproj"/>
    <!--#endif-->
    <ProjectReference Include="..\Web.Contracts\Web.Contracts.csproj"/>
    <ProjectReference Include="D:\git\github\TimeWarpEngineering\blazor-state\Source\BlazorState\BlazorState.csproj" />
    <InternalsVisibleTo Include="Web.Spa.Integration.Tests"/>
    <InternalsVisibleTo Include="Web.Server.Integration.Tests"/>
  </ItemGroup>

  <ItemGroup>
    <!--<ServiceWorker Include="wwwroot\service-worker.js" PublishedContent="wwwroot\service-worker.published.js" />-->
    <Folder Include="Components\Editors\"/>
    <Folder Include="Features\Admin\" />
    <Folder Include="Features\CurrentUser\" />
    <Folder Include="Features\Modal\Actions\"/>
    <Folder Include="Features\Notification\Actions\RemoveNotification\"/>
    <Folder Include="Features\Notification\Components\"/>
    <Folder Include="Features\ToDo\Actions"/>
    <Folder Include="Generated\net8.0\Morris.Moxy\Morris.Moxy.RoslynIncrementalGenerator\"/>
  </ItemGroup>

  <ItemGroup>
    <TypeScriptInputs Include="source\*.*"/>
    <AdditionalFiles Include="Features\Base\StateAccessMixin.mixin"/>
    <AdditionalFiles Include="Mixins\Page.mixin"/>
  </ItemGroup>

  <ItemGroup>
    <_ContentIncludedByDefault Remove="Pages\Authentication\ProfilePage.razor" />
    <_ContentIncludedByDefault Remove="Pages\Authentication\SettingsPage.razor" />
    <_ContentIncludedByDefault Remove="Pages\Authentication\_Imports.razor" />
  </ItemGroup>

  <!-- Target to copy scoped CSS to a more accessible location -->
  <Target Name="CopyScopedCss" AfterTargets="Build">
    <Copy SourceFiles="$(ProjectDir)obj\$(ConfigurationName)\$(TargetFramework)\scopedcss\bundle\$(ProjectName).styles.css"
          DestinationFolder="$(ProjectDir)obj\css\"
          SkipUnchangedFiles="true" />
  </Target>
  
  <Target Name="Tailwind" AfterTargets="Build,CopyScopedCss">
    <Exec Command="npm install" />
    <Exec Command="npm run prettier" />
    <Exec Command="npm run build" />
    <Exec Command="npm run css:build" />
  </Target>

  <Target Name="CreateDummyFluentUICSS" BeforeTargets="Build">
    <ItemGroup>
      <DummyCSSFile Include="$(ProjectDir)obj\css\_content\Microsoft.FluentUI.AspNetCore.Components\Microsoft.FluentUI.AspNetCore.Components.bundle.scp.css" />
    </ItemGroup>
    <MakeDir Directories="$(ProjectDir)obj\css\_content\Microsoft.FluentUI.AspNetCore.Components" />
    <WriteLinesToFile File="@(DummyCSSFile)" Lines="/* Dummy file to satisfy build requirement */" Overwrite="true" />
  </Target>
  
</Project>
